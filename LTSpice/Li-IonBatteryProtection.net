* H:\src\GitHub\Li-IonBatteryProtection\LTSpice\Li-IonBatteryProtection.asc
R1 Sawtooth-1 -Comp-1 10k
R2 Sawtooth-1 +Comp-1 1k tol=1 pwr=0.1
R3 +Comp-1 0 620k tol=1 pwr=0.1
R4 Sawtooth-1 Out-U1 100k tol=1 pwr=0.1
D§Z1 0 -Comp-1 1N4728
V1 Sawtooth-1 0 PULSE(3.6 0 0 1 0 0 1 1)
RLoad Output+V Output-V 2
XQ4 Output-V Bias-4 0 irf540n
R5 Out-U1 +Comp-1 47k
R6 N004 Out-U1 100
C4 Output-V 0 47µf
V2 Output+V 0 PULSE(14.4 0 0 1 0 0 1 1)
R9 Bias-4 Output+V 3.3k
XU2 N003 TP-Q1 Bias-2 0 PC817 Igain=2.3m
Q1 TP-Q1 N004 0 0 2N2222
R7 Sawtooth-1 N003 120
R15 Out-U2 +Comp-2 47k
R11 Sawtooth-2 -Comp-2 10k
R12 Sawtooth-2 +Comp-2 1k
R13 +Comp-2 Sawtooth-1 620k
R14 Sawtooth-2 Out-U2 100k
D§Z2 Sawtooth-1 -Comp-2 1N4728
V3 Sawtooth-2 Sawtooth-1 PULSE(3.6 0 0 1 0 0 1 2)
R16 N002 Out-U2 100
Q2 TP-Q2 N002 Sawtooth-1 0 2N2222
R17 Sawtooth-2 N001 120
XU4 N001 TP-Q2 Bias-2 0 PC817 Igain=2.3m
XU1 +Comp-1 -Comp-1 Sawtooth-1 0 Out-U1 0 LM311
XU3 +Comp-2 -Comp-2 Sawtooth-2 Sawtooth-1 Out-U2 Sawtooth-1 LM311
Q3 Bias-4 Bias-3 0 0 2N2222
R10 Output+V Bias-2 20k
R8 Bias-3 Bias-2 5.1k
C1 Bias-2 0 0.1µf
C2 Bias-3 0 0.22µf
C3 Output+V Bias-4 0.001µf
.model D D
.lib C:\Program Files\LTC\LTspiceIV\lib\cmp\standard.dio
.model NPN NPN
.model PNP PNP
.lib C:\Program Files\LTC\LTspiceIV\lib\cmp\standard.bjt
.inc LM393A.sub
.inc 1N4733.sub
.inc irf540n.sub
.tran 2000m
.inc PC817.sub
.inc LM311.sub
* R10 -- 14.4V = 20k, 7.2V = 6.2k
* R9 -- 14.4V = 3.3k, 7.2V = 1.8K
* 16.6 mA through both optos
* Li-Ion Battery Protector
* Carl J. Nobile
* 2017-07-23
.lib LM311.sub
.lib PC817.sub
.backanno
.end
